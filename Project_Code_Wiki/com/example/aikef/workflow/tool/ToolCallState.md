# ToolCallState

## 1. Class Profile
- **Class Name**: `ToolCallState`
- **Package**: `com.example.aikef.workflow.tool`
- **Type**: `Class`
- **Role**: State Object
- **Purpose**: Tracks the lifecycle and state of tool executions within a workflow. It manages the complex flow of detecting tool calls, extracting parameters, handling missing information (human-in-the-loop), and recording results.

## 2. Method Deep Dive
### Fields
- `status`: Current status of the tool call (e.g., `IDLE`, `EXTRACTING_PARAMS`, `WAITING_USER_INPUT`, `EXECUTING_TOOL`, `TOOL_COMPLETED`).
- `pendingToolCalls`: List of tool requests waiting to be processed.
- `currentToolCall`: The specific tool request currently being handled.
- `completedResults`: List of results from finished tool executions.
- `collectedParams` / `missingParams`: Maps and lists for parameter slot-filling.
- `nextQuestion`: The question generated by the AI to ask the user for missing info.
- `pausedNodeId`: Records which workflow node triggered the pause.
- `llmMessageWithToolCall`: Stores the original LLM response that initiated the tool call.

### Key Methods
- `reset()`: Clears all state data to `IDLE`.
- `shouldPauseWorkflow()`: Returns true if the status is `WAITING_USER_INPUT`.
- `hasAllParams()`: Checks if `missingParams` is empty.
- `addToolCall(ToolCallRequest request)`: Queues a new tool call.
- `addResult(ToolCallResult result)`: Records a successful execution.

## 3. Dependency Graph
- **Internal Dependencies**:
  - `ToolCallRequest`: Represents the request to execute a tool.
  - `ToolCallResult`: Represents the output of a tool execution.
- **External Dependencies**:
  - `lombok.Data`: Generates getters, setters, and other boilerplate.

## 4. Usage Guide
This class is transient and typically serialized into `WorkflowPausedState` or held in memory during execution.
- **Multi-turn Slot Filling**: If a tool requires 3 parameters and the user provides 1, this state tracks the collected one and the 2 missing ones. It then drives the generation of a follow-up question.
- **Execution Context**: It serves as the "working memory" for the `ToolExecutionService`, ensuring that complex, multi-step tool interactions are handled correctly.

## 5. Source Link
[ToolCallState.java](file:///D:/ai_agent_work/ai_agent_workflow/ai_kef/src/main/java/com/example/aikef/workflow/tool/ToolCallState.java)
